# JRDB データスキーマ仕様書

## 目次

1. [概要](#1-概要)
2. [データ分類](#2-データ分類)
3. [主要データタイプ仕様](#3-主要データタイプ仕様)
4. [コードテーブル](#4-コードテーブル)
5. [データ連携構造](#5-データ連携構造)
6. [ファイル形式](#6-ファイル形式)

---

## 1. 概要

JRDBは競馬データを提供するサービスで、前日系・直前系・成績系・マスタ系の4つのカテゴリに分類されたデータを提供しています。

### データの特徴
- **固定長テキスト形式**: 各レコードは固定バイト数
- **文字コード**: CP932 (Shift-JIS)
- **改行コード**: CR+LF (Windows形式)
- **配信形式**: LZH圧縮ファイル
- **更新頻度**: データタイプごとに異なる（金曜19時、土曜20時、木曜16時など）

---

## 2. データ分類

### 2.1 前日系データ (Pre-Day Data)

レース前日に取得可能なデータ群。予測モデルの主要入力データ。

| データタイプ | 名称 | 説明 |
|------------|------|------|
| **KY** | 競走馬データ | 馬の能力指数・適性・印 |
| **UK** | 馬基本データ | 血統・馬主・生産者情報 |
| **ZE** | 前走データ | 過去5走の成績（重要な連携フィールド） |
| **ZK** | 前走拡張データ | 過去5走の詳細成績 |
| **BA** | 番組データ | レース条件・賞金情報 |
| **OZ** | 基準オッズ | 単勝・複勝・馬連オッズ |
| **OW** | ワイドオッズ | ワイド馬券オッズ |
| **OU** | 馬単オッズ | 馬単馬券オッズ |
| **OT** | 三連複オッズ | 三連複馬券オッズ |
| **OV** | 三連単オッズ | 三連単馬券オッズ |
| **JO** | 情報データ | 情報筋の指数・印 |
| **KK** | 競走馬拡張データ | 条件別成績集計 |
| **CY** | 調教分析データ | 調教評価・コメント |
| **CH** | 調教本追切データ | 追い切りタイム分析 |

### 2.2 直前系データ (Pre-Race Data)

レース直前（発走15分前）に更新されるデータ。

| データタイプ | 名称 | 説明 |
|------------|------|------|
| **TY** | 直前情報データ | 最新オッズ + パドック情報 |

### 2.3 成績系データ (Results Data)

レース後に確定する実績データ。学習データとして使用。

| データタイプ | 名称 | 説明 |
|------------|------|------|
| **HJ** | 払戻情報データ | 馬券払戻金情報 |
| **SE** | 成績データ | レース結果・分析指数 |
| **SR** | 成績レースデータ | ハロンタイム・コーナー位置 |
| **SK** | 成績拡張データ | 装備・コメント付き成績 |

### 2.4 マスタ系データ (Master Data)

騎手・調教師・除外馬などのマスタ情報。

| データタイプ | 名称 | 説明 |
|------------|------|------|
| **KZ/KS** | 騎手データ | 全騎手 / 当週更新 |
| **CZ/CS** | 調教師データ | 全調教師 / 当週更新 |
| **MZ/MS** | 除外馬データ | 除外馬情報 |

---

## 3. 主要データタイプ仕様

### 3.1 KYG/KYH/KYI - 競走馬データ

**更新頻度**: 金曜19:00、土曜20:00
**レコード長**: 545バイト
**ファイル名例**: KYG241231.lzh

#### 主要フィールド

| フィールド名 | バイト数 | 説明 |
|------------|---------|------|
| レースキー | 8 | 場コード(2) + 年(2) + 回(1) + 日(1) + R(2) |
| 馬番 | 2 | 馬番号 |
| 血統登録番号 | 8 | 馬の一意識別子 |
| 馬名 | 36 | 全角18文字 |
| **IDM** | 5 | JRDB独自の能力指数（重要） |
| 騎手指数 | 5 | 騎手の能力指数 |
| 情報指数 | 5 | 情報筋評価指数 |
| 総合指数 | 5 | IDM + 騎手 + 情報の総合 |
| **脚質** | 1 | 1=逃げ, 2=先行, 3=差し, 4=追込, 5=好位差し, 6=自在 |
| **距離適性** | 1 | 1=短距離, 2=中距離, 3=長距離, 5=マイル, 6=万能 |
| **上昇度** | 2 | AA/A/B/C/? (調子の上昇・下降) |
| 基準オッズ | 5 | 予想単勝オッズ |
| 人気順位 | 2 | 予想人気順 |
| 調教師指数 | 5 | 調教師の能力指数 |
| 厩舎指数 | 5 | 厩舎の能力指数 |
| **調教矢印コード** | 1 | 1=デキ抜群 ... 5=デキ落ち（5段階評価） |
| 厩舎評価コード | 1 | 1=超強気 ... 4=弱気 |
| 蹄コード | 2 | 蹄のサイズ・形状 |
| クラスコード | 2 | 芝/ダート/障害別のクラス分類 |
| 騎手名 | 12 | 全角6文字 |
| 調教師名 | 12 | 全角6文字 |
| 前走1～5競走成績キー | 16×5 | 過去5走へのリンクキー |
| **印コード** | 3 | 総合印/IDM印/情報印 (◎○▲注△☆) |
| 馬具コード | 3 | ブリンカー等の装備 |

#### 重要指標の解説

**IDM (Index of Data Mining)**
- JRDBが独自に開発した総合能力指数
- 過去の走破タイム・馬場差・ペース・斤量などを総合的に分析
- 数値が高いほど能力が高い
- 同一レース内での相対比較に有効

**脚質コード**
- 1: 逃げ - レース序盤から先頭で走る
- 2: 先行 - 先頭集団で走る
- 3: 差し - 後方から追い込む
- 4: 追込 - 最後方から一気に追い込む
- 5: 好位差し - 中団から差す
- 6: 自在 - 展開に応じて柔軟に対応

**上昇度**
- AA: 大幅な能力向上が期待できる
- A: 能力向上の可能性あり
- B: 現状維持
- C: やや能力低下の可能性
- ?: 下降傾向、厳しいレース

**調教矢印コード**
- 1: デキ抜群 - 調教で非常に良い動き
- 2: 上昇 - 調子が上向き
- 3: 平行線 - 現状維持
- 4: やや下降気味 - 調子がやや落ちている
- 5: デキ落ち - 調子が悪い

---

### 3.2 BAB/BAC - 番組データ

**更新頻度**: 月・木・金・土曜
**レコード長**: 168-176バイト
**ファイル名例**: BAC241231.lzh

#### 主要フィールド

| フィールド名 | バイト数 | 説明 |
|------------|---------|------|
| レースキー | 8 | 場コード + 年 + 回 + 日 + R |
| 発走時間 | 4 | HHMM形式 |
| **距離** | 4 | メートル単位 |
| 芝ダ障害コード | 1 | 1=芝, 2=ダート, 3=障害 |
| 右左 | 1 | 1=右, 2=左, 3=直線 |
| 内外 | 1 | 1=内, 2=外, 3=内→外, 7=外→内 |
| **種別** | 2 | 11=2歳, 12=3歳, 13=3歳以上, 14=4歳以上 |
| **条件** | 2 | A1=新馬, 04=1勝クラス, 15=3勝クラス, OP=オープン |
| **記号** | 3 | 混合・外国産馬・性別制限など |
| **重量** | 1 | 1=ハンデ, 2=別定, 3=馬齢, 4=定量 |
| **グレード** | 1 | 1=G1, 2=G2, 3=G3, 4=重賞, 5=特別, 6=L |
| レース名 | 50 | 全角25文字 |
| 頭数 | 2 | 出走頭数 |
| 1着賞金 | 5 | 万円単位 |
| 2着賞金 | 5 | 万円単位 |
| 3着賞金 | 5 | 万円単位 |
| 4着賞金 | 5 | 万円単位 |
| 5着賞金 | 5 | 万円単位 |
| 1着算入賞金 | 5 | 収得賞金加算額 |
| 2着算入賞金 | 5 | 収得賞金加算額 |
| 馬券発売フラグ | 16 | 各券種の発売有無（ビット単位） |

#### 条件コードの詳細

| コード | 説明 | 旧表記 |
|-------|------|--------|
| A1 | 新馬 | 新馬 |
| A2 | 未出走 | 未出走 |
| A3 | 未勝利 | 未勝利/0勝 |
| 04/05 | 1勝クラス | 400万下/500万下 |
| 10/16 | 2勝クラス | 1000万下/1600万下 |
| 15/16 | 3勝クラス | 1500万下/1600万下 |
| OP | オープン | オープン |

---

### 3.3 KAA/KAB - 開催データ

**更新頻度**: 月・木・金・土曜
**レコード長**: 56-72バイト
**ファイル名例**: KAA241231.lzh

#### 主要フィールド

| フィールド名 | バイト数 | 説明 |
|------------|---------|------|
| 場コード | 2 | 01=札幌 ... 10=小倉 |
| 年 | 2 | 西暦下2桁 |
| 回 | 1 | 開催回数 |
| 日 | 2 | 開催日次 |
| 開催区分 | 1 | 1=関東, 2=関西, 3=ローカル |
| 曜日 | 1 | 1=月 ... 7=日 |
| 場名 | 4 | 全角2文字 |
| **天候コード** | 1 | 1=晴, 2=曇, 3=小雨, 4=雨, 5=小雪, 6=雪 |
| **芝馬場状態コード** | 2 | 10=良, 20=稍重, 30=重, 40=不良 |
| **ダ馬場状態コード** | 2 | 同上 |
| **芝馬場状態内** | 2 | 1=良, 2=稍重, 3=重, 4=不良 |
| **芝馬場状態中** | 2 | 同上 |
| **芝馬場状態外** | 2 | 同上 |
| **ダ馬場状態内** | 2 | 同上 |
| **ダ馬場状態中** | 2 | 同上 |
| **ダ馬場状態外** | 2 | 同上 |
| 芝馬場差 | 3 | 内-最内差（0.1秒単位） |
| データ区分 | 1 | 1=特登, 2=予想確定, 3=枠確定, 4=前日 |
| 連続何日目 | 1 | 同一開催の連続日数 |
| 芝種類 | 1 | 1=日本, 2=洋芝, 3=混合 |
| 草丈 | 2 | センチメートル単位 |
| 転圧 | 1 | 1=有, 0=無 |
| 凍結防止剤 | 1 | 1=有, 0=無 |
| 中間降水量 | 3 | ミリメートル単位 |

#### 馬場状態の詳細

| コード | 状態 | 説明 |
|-------|------|------|
| 10 | 良 | 最良の状態 |
| 11 | 速良 | 良だが時計が速い |
| 12 | 遅良 | 良だが時計が遅い |
| 20 | 稍重 | やや重い |
| 21 | 速稍重 | 稍重だが時計が速い |
| 22 | 遅稍重 | 稍重だが時計が遅い |
| 30 | 重 | 重い |
| 31 | 速重 | 重だが時計が速い |
| 32 | 遅重 | 重だが時計が遅い |
| 40 | 不良 | 最悪の状態 |
| 41 | 速不良 | 不良だが時計が速い |
| 42 | 遅不良 | 不良だが時計が遅い |

---

### 3.4 SEC - 成績データ

**更新頻度**: 木曜16:00（週次）
**レコード長**: 346バイト
**ファイル名例**: SEC241231.lzh

#### 主要フィールド

| フィールド名 | バイト数 | 説明 |
|------------|---------|------|
| レースキー | 8 | レース識別子 |
| 馬番 | 2 | 馬番号 |
| 血統登録番号 | 8 | 馬の一意識別子 |
| 馬名 | 36 | 全角18文字 |
| **着順** | 2 | 1～18, 中止/除外 |
| **走破タイム** | 4 | 秒単位（小数点以下1桁） |
| **上がり3F** | 3 | 0.1秒単位 |
| 斤量 | 3 | キログラム単位 |
| 騎手名 | 12 | 全角6文字 |
| 調教師名 | 12 | 全角6文字 |
| **IDM** | 5 | 能力指数 |
| **素点** | 3 | 走破タイム素点 |
| **馬場差** | 3 | 馬場による時計差 |
| **ペース** | 3 | ペースによる時計差 |
| **出遅** | 3 | 出遅れによるロス |
| **位置取** | 3 | 位置取りによる損得 |
| **前不利** | 3 | 前半の不利 |
| **中不利** | 3 | 中盤の不利 |
| **後不利** | 3 | 後半の不利 |
| **テン指数** | 5 | 前半3Fの指数 |
| **上がり指数** | 5 | 後半3Fの指数 |
| **ペース指数** | 5 | ペース総合指数 |
| **レースP指数** | 5 | レースペース指数 |
| 前3F先頭差 | 3 | 前半3F時点での先頭との差 |
| 後3F先頭差 | 3 | 後半3F時点での先頭との差 |
| コーナー順位1 | 2 | 1コーナー通過順位 |
| コーナー順位2 | 2 | 2コーナー通過順位 |
| コーナー順位3 | 2 | 3コーナー通過順位 |
| コーナー順位4 | 2 | 4コーナー通過順位 |
| 10時オッズ | 6 | 前日10時時点のオッズ |
| **馬体重** | 3 | キログラム単位 |
| **馬体重増減** | 3 | 前走比の増減 |
| 天候コード | 1 | 1=晴 ... 6=雪 |
| コース | 1 | 1=芝, 2=ダート, 3=障害 |
| レース脚質 | 1 | 1=逃げ, 2=先行, 3=差し, 4=追込 |

#### JRDB分析指数の詳細

**IDM (能力指数)**
- レース全体の能力を総合評価
- 馬場差・ペース・斤量・不利などを考慮した補正値

**素点**
- 走破タイムの基礎点
- 同一条件での比較基準

**馬場差**
- 馬場状態による時計への影響
- プラス値 = 馬場が速い、マイナス値 = 馬場が遅い

**ペース**
- レースペースによる時計への影響
- プラス値 = ペースが速い、マイナス値 = ペースが遅い

**出遅**
- スタート時の出遅れによるタイムロス
- 数値が大きいほど出遅れが大きい

**位置取**
- レース中の位置取りによる損得
- プラス値 = 有利な位置、マイナス値 = 不利な位置

**前不利/中不利/後不利**
- レース各区間での不利（進路妨害、外回しなど）
- 数値が大きいほど不利が大きい

**テン指数**
- 前半3Fの能力指数
- 先行力の評価

**上がり指数**
- 後半3Fの能力指数
- 末脚の評価

---

### 3.5 SKB - 成績拡張データ

**更新頻度**: 木曜16:00（週次）
**レコード長**: 304バイト
**ファイル名例**: SKB241231.lzh

#### 主要フィールド

| フィールド名 | バイト数 | 説明 |
|------------|---------|------|
| レースキー | 8 | レース識別子 |
| 馬番 | 2 | 馬番号 |
| **特記コード** | 3 | 特殊な状況コード（940種類以上） |
| **馬具コード** | 3 | 装備コード（ブリンカー等） |
| **脚元コード左前** | 3 | 左前脚の状態コード |
| **脚元コード右前** | 3 | 右前脚の状態コード |
| **脚元コード左後** | 3 | 左後脚の状態コード |
| **脚元コード右後** | 3 | 右後脚の状態コード |
| **パドックコメント** | 40 | 全半角混在（実質20文字程度） |
| **脚元コメント** | 40 | 全半角混在 |
| **馬具(その他)コメント** | 40 | 全半角混在 |
| **レースコメント** | 40 | 全半角混在 |
| ハミ | 1 | 1=使用, 0=不使用 |
| バンテージ | 1 | 1=使用, 0=不使用 |
| 蹄鉄 | 1 | 状態コード |
| 蹄状態 | 1 | 状態コード |
| ソエ | 1 | 1=有, 0=無 |
| 骨瘤 | 1 | 1=有, 0=無 |

#### コメントの活用

**パドックコメント**
- 馬体の状態、気配、動き
- 例: "馬体良い", "イレ込み", "落ち着き"

**脚元コメント**
- 脚元の状態、バンテージの使用状況
- 例: "バンテージ前", "蹄汚い", "球節腫れる"

**レースコメント**
- レース中の展開、不利、位置取り
- 例: "道中外回し", "4角不利", "直線伸びる"

---

### 3.6 HJA/HJC - 払戻情報データ

**更新頻度**: レース当日18:00
**レコード長**: 240バイト
**ファイル名例**: HJA241231.lzh

#### 主要フィールド

| フィールド名 | バイト数 | 説明 |
|------------|---------|------|
| レースキー | 8 | レース識別子 |
| **単勝払戻** | 7×3 | 馬番(2) + 払戻(5) × 3件 |
| **複勝払戻** | 7×5 | 馬番(2) + 払戻(5) × 5件 |
| **枠連払戻** | 9×3 | 枠番(2+2) + 払戻(5) × 3件 |
| **馬連払戻** | 11×3 | 馬番(2+2) + 払戻(5) + 人気(2) × 3件 |
| **ワイド払戻** | 11×7 | 馬番(2+2) + 払戻(5) + 人気(2) × 7件 |
| **馬単払戻** | 11×6 | 馬番(2+2) + 払戻(5) + 人気(2) × 6件 |
| **三連複払戻** | 13×3 | 馬番(2+2+2) + 払戻(5) + 人気(2) × 3件 |
| **三連単払戻** | 13×6 | 馬番(2+2+2) + 払戻(5) + 人気(2) × 6件 |

---

### 3.7 UKC - 馬基本データ

**更新頻度**: 金曜19:00、土曜20:00
**レコード長**: 292バイト
**ファイル名例**: UKC241231.lzh

#### 主要フィールド

| フィールド名 | バイト数 | 説明 |
|------------|---------|------|
| 血統登録番号 | 8 | 馬の一意識別子 |
| 馬名 | 36 | 全角18文字 |
| **性別コード** | 1 | 1=牡, 2=牝, 3=セ |
| **毛色コード** | 2 | 01=栗毛 ... 11=白毛 |
| 馬記号コード | 2 | 外国産馬・抽選馬など |
| **父馬名** | 36 | 全角18文字 |
| **母馬名** | 36 | 全角18文字 |
| **母父馬名** | 36 | 全角18文字 |
| **生年月日** | 8 | YYYYMMDD |
| 父馬生年 | 4 | YYYY |
| 母馬生年 | 4 | YYYY |
| 母父馬生年 | 4 | YYYY |
| **馬主名** | 40 | 全角20文字 |
| 馬主会コード | 1 | 1=JRA, 2=地方, 3=外国 |
| **生産者名** | 40 | 全角20文字 |
| **産地名** | 8 | 全角4文字 |
| 登録抹消フラグ | 1 | 0=現役, 1=抹消 |
| データ年月日 | 8 | YYYYMMDD |
| **父系統コード** | 4 | 系統分類（180種類以上） |
| **母父系統コード** | 4 | 系統分類 |

---

### 3.8 CHA - 調教本追切データ

**更新頻度**: 金曜・土曜20:00
**レコード長**: 64バイト
**ファイル名例**: CHA241231.lzh

#### 主要フィールド

| フィールド名 | バイト数 | 説明 |
|------------|---------|------|
| レースキー | 8 | レース識別子 |
| 馬番 | 2 | 馬番号 |
| **曜日** | 1 | 通常は水・木曜 |
| **調教年月日** | 8 | YYYYMMDD |
| 回数 | 1 | 追切当日の調教回数 |
| **調教コースコード** | 2 | 01=美浦坂路, 02=南W ... |
| **追切種類** | 1 | 1=馬なり, 2=強目, 3=一杯 |
| **追い状態** | 2 | 詳細な追い方コード |
| 乗り役 | 1 | 1=助手, 2=調教師, 3=騎手, 4=調教騎手, 5=見習 |
| **調教F** | 1 | ハロン長 |
| **テンF** | 3 | 前半タイム（0.1秒単位） |
| **中間F** | 3 | 中間タイム（0.1秒単位） |
| **終いF** | 3 | 終盤タイム（0.1秒単位） |
| **テン指数** | 3 | 前半の指数 |
| **中間指数** | 3 | 中間の指数 |
| **終い指数** | 3 | 終盤の指数 |
| **追切指数** | 3 | 総合指数 |
| 併せ馬相手データ | 10 | 併せ馬時の情報 |

---

### 3.9 CYA/CYB - 調教分析データ

**更新頻度**: 金曜・土曜20:00
**レコード長**: 88バイト
**ファイル名例**: CYA241231.lzh

#### 主要フィールド

| フィールド名 | バイト数 | 説明 |
|------------|---------|------|
| レースキー | 8 | レース識別子 |
| 馬番 | 2 | 馬番号 |
| **調教タイプ** | 1 | コード分類 |
| 調教コース種別 | 1 | 複数コース使用の分類 |
| **坂** | 2 | 01=有, 00=無 |
| **W** | 2 | ウッドチップ使用 |
| **ダ** | 2 | ダート使用 |
| **芝** | 2 | 芝使用 |
| **プ** | 2 | プール使用 |
| **障** | 2 | 障害使用 |
| **調教距離** | 1 | 1=長, 2=標準, 3=短, 4=2本 |
| **調教重点** | 1 | 1=テン, 2=中, 3=終い |
| **追切指数** | 3 | 数値指数 |
| **仕上指数** | 3 | 数値指数 |
| 調教量評価 | 1 | A/B/C/D |
| 仕上指数変化 | 3 | 前回比の変化 |
| **調教コメント** | 40 | 厩舎関係者のコメント |
| コメント年月日 | 8 | 対象調教日 |
| **調教評価** | 1 | 1=◎, 2=○, 3=△ |

---

### 3.10 OZ - 基準オッズデータ

**更新頻度**: 金曜19:00、土曜20:00
**レコード長**: 957バイト
**ファイル名例**: OZ241231.lzh

#### 主要フィールド

| フィールド名 | バイト数 | 説明 |
|------------|---------|------|
| レースキー | 8 | レース識別子 |
| 登録頭数 | 2 | 出走馬数 |
| **単勝オッズ** | 5×18 | 18頭分のオッズ（90バイト） |
| **複勝オッズ** | 5×18 | 18頭分のオッズ（90バイト） |
| **馬連オッズ** | 5×153 | 153通りの組合せ（765バイト） |

---

### 3.11 JOA - 情報データ

**更新頻度**: 金曜19:00、土曜20:00
**レコード長**: 116バイト
**ファイル名例**: JOA241231.lzh

#### 主要フィールド

| フィールド名 | バイト数 | 説明 |
|------------|---------|------|
| レースキー | 8 | レース識別子 |
| 馬番 | 2 | 馬番号 |
| 血統登録番号 | 8 | 馬の一意識別子 |
| 馬名 | 36 | 全角18文字 |
| 基準オッズ | 5 | 単勝オッズ |
| 基準複勝オッズ | 5 | 複勝オッズ |
| **CID調教素点** | 3 | 調教スコア |
| **CID厩舎素点** | 3 | 厩舎スコア |
| **CID総合素点** | 3 | 総合スコア |
| **CID指数** | 3 | CID総合指数 |
| **LS指数** | 5 | ライフスタイル指数 |
| LS評価 | 1 | A/B/C |
| EMフラグ | 1 | 1=除外推奨 |
| **厩舎BB印** | 1 | 印コード（◎○▲注△☆） |
| 厩舎BB勝率 | 4 | ◎印の勝率 |
| 厩舎BB連対率 | 4 | ◎印の連対率 |
| **騎手BB印** | 1 | 印コード |
| 騎手BB勝率 | 4 | ◎印の勝率 |
| 騎手BB連対率 | 4 | ◎印の連対率 |

---

### 3.12 KKA - 競走馬拡張データ

**更新頻度**: 金曜19:00、土曜20:00
**レコード長**: 324バイト
**ファイル名例**: KKA241231.lzh

#### 主要フィールド

| フィールド名 | バイト数 | 説明 |
|------------|---------|------|
| レースキー | 8 | レース識別子 |
| 馬番 | 2 | 馬番号 |
| **JRA成績** | 12 | 勝-2着-3着-着外 |
| **交流成績** | 12 | 認定交流競走の成績 |
| **他成績** | 12 | 地方・海外成績 |
| **芝成績** | 12 | 芝コースでの成績 |
| **ダート成績** | 12 | ダートコースでの成績 |
| **距離別成績** | 12×複数 | 距離帯別の成績 |
| **回り別成績** | 12×2 | 右回り・左回り |
| **騎手成績** | 12 | 今回騎手との成績 |
| **馬場状態別成績** | 12×4 | 良・稍重・重・不良別 |
| **ペース別成績** | 12×3 | スロー・ミドル・ハイペース |
| **季節別成績** | 12×4 | 春・夏・秋・冬 |
| **枠番別成績** | 12×8 | 1～8枠別 |
| 騎手距離成績 | 8 | 騎手の当該距離成績 |
| **父馬芝連対率** | 3 | 種牡馬の芝連対率(%) |
| **父馬ダ連対率** | 3 | 種牡馬のダート連対率(%) |
| **母父馬芝連対率** | 3 | 母父の芝連対率(%) |
| **母父馬ダ連対率** | 3 | 母父のダート連対率(%) |

---

### 3.13 SRA - 成績レースデータ

**更新頻度**: 木曜16:00（週次）
**レコード長**: 408バイト
**ファイル名例**: SRA241231.lzh

#### 主要フィールド

| フィールド名 | バイト数 | 説明 |
|------------|---------|------|
| レースキー | 8 | レース識別子 |
| **ハロンタイム** | 3×18 | 18ハロン分のタイム（0.1秒単位） |
| **1コーナー位置取り** | 64 | 1コーナー通過時の並び |
| **2コーナー位置取り** | 64 | 2コーナー通過時の並び |
| **3コーナー位置取り** | 64 | 3コーナー通過時の並び |
| **4コーナー位置取り** | 64 | 4コーナー通過時の並び |

#### ハロンタイムの解釈
- 200m刻みが基本（1F = 200m）
- 1700m, 2100mなどの場合、1ハロン目が100m
- 先頭馬のペースで計測
- ペース分析、展開予測に活用

---

### 3.14 ZED - 前走データ

**更新頻度**: 金曜19:00、土曜20:00
**レコード長**: 346バイト（SECと同じ）
**ファイル名例**: ZED241231.lzh

**説明**: 成績データ（SEC）と同じフォーマット。各馬の過去5走の成績が含まれる。KYGデータの「前走1～5競走成績キー」でリンク。

---

## 4. コードテーブル

### 4.1 脚質コード

| コード | 名称 | 説明 |
|-------|------|------|
| 1 | 逃げ | レース序盤から先頭で走る |
| 2 | 先行 | 先頭集団で走る |
| 3 | 差し | 後方から追い込む |
| 4 | 追込 | 最後方から一気に追い込む |
| 5 | 好位差し | 中団から差す |
| 6 | 自在 | 展開に応じて柔軟に対応 |

---

### 4.2 距離適性コード

| コード | 名称 | 距離目安 |
|-------|------|----------|
| 1 | 短距離 | ～1400m |
| 2 | 中距離 | 1600m～2000m |
| 3 | 長距離 | 2200m～ |
| 5 | マイル | 1400m～1800m |
| 6 | 万能 | 全距離対応 |

---

### 4.3 上昇度コード

| コード | 名称 | 説明 |
|-------|------|------|
| 1 | AA | 大幅な能力向上が期待できる |
| 2 | A | 能力向上の可能性あり |
| 3 | B | 現状維持 |
| 4 | C | やや能力低下の可能性 |
| 5 | ? | 下降傾向、厳しいレース |

---

### 4.4 調教矢印コード

| コード | 名称 | 説明 |
|-------|------|------|
| 1 | デキ抜群 | 調教で非常に良い動き |
| 2 | 上昇 | 調子が上向き |
| 3 | 平行線 | 現状維持 |
| 4 | やや下降気味 | 調子がやや落ちている |
| 5 | デキ落ち | 調子が悪い |

---

### 4.5 厩舎評価コード

| コード | 名称 | 説明 |
|-------|------|------|
| 1 | 超強気 | 厩舎が非常に強気 |
| 2 | 強気 | 厩舎が強気 |
| 3 | 現状維持 | 中立的な評価 |
| 4 | 弱気 | 厩舎が弱気 |

---

### 4.6 蹄コード

**形式**: サイズ(1桁) + 形状(1桁)

**サイズ**:
- 大 = Large
- 中 = Medium
- 小 = Small
- 細 = Fine

**形状**:
- 立 = Upright
- 標準 = Standard
- ベタ = Flat

**例**:
- 01 = 大ベタ
- 06 = 中立
- 10 = 中標準

---

### 4.7 重馬場適性コード

| コード | 記号 | 説明 |
|-------|------|------|
| 1 | ◎ | 得意 |
| 2 | ○ | 普通 |
| 3 | △ | 苦手 |

---

### 4.8 クラスコード

**芝（01～18）**:
- 01 = G1
- 02 = G2
- 03 = G3
- 04-06 = OP (A/B/C)
- 07-09 = 3勝クラス (A/B/C)
- 10-12 = 2勝クラス (A/B/C)
- 13-15 = 1勝クラス (A/B/C)
- 16-18 = 未勝利 (A/B/C)

**ダート（21～38）**:
- 21 = G1
- 22 = G2
- 23 = G3
- 24-26 = OP (A/B/C)
- 27-29 = 3勝クラス (A/B/C)
- 30-32 = 2勝クラス (A/B/C)
- 33-35 = 1勝クラス (A/B/C)
- 36-38 = 未勝利 (A/B/C)

**障害（51～62）**:
- 51 = G1
- 52 = G2
- 53 = G3
- 54-56 = OP (A/B/C)
- 57-59 = 1勝クラス (A/B/C)
- 60-62 = 未勝利 (A/B/C)

---

### 4.9 場コード

**JRA競馬場（01～10）**:
- 01 = 札幌
- 02 = 函館
- 03 = 福島
- 04 = 新潟
- 05 = 東京
- 06 = 中山
- 07 = 中京
- 08 = 京都
- 09 = 阪神
- 10 = 小倉

**地方競馬場（21～49）**:
- 21 = 旭川
- 22 = 札幌(地方)
- 23 = 門別
- 24 = 北見
- 25 = 岩見沢
- 26 = 帯広
- 30 = 盛岡
- 31 = 水沢
- 32 = 上山
- 33 = 三条
- 34 = 足利
- 35 = 宇都宮
- 36 = 高崎
- 37 = 浦和
- 38 = 船橋
- 39 = 大井
- 40 = 川崎
- 41 = 金沢
- 42 = 笠松
- 43 = 名古屋
- 44 = 紀三井寺
- 45 = 園田
- 46 = 姫路
- 47 = 益田
- 48 = 福山
- 49 = 高知
- 50 = 佐賀
- 51 = 荒尾
- 52 = 中津

**海外競馬場（61～79）**:
- 61 = 英国
- 62 = 愛国
- 63 = 仏国
- 64 = 伊国
- 65 = 独国
- 66 = 米国
- 67 = カナダ
- 68 = UAE
- 69 = 豪州
- 70 = ニュージーランド
- 71 = 香港
- 72 = チリ
- 73 = シンガポール
- 74 = スウェーデン
- 75 = マカオ
- 76 = オーストリア
- 77 = トルコ
- 78 = カタール
- 79 = 韓国

---

### 4.10 馬場状態コード

| コード | 状態 | 説明 |
|-------|------|------|
| 10 | 良 | 最良の状態 |
| 11 | 速良 | 良だが時計が速い |
| 12 | 遅良 | 良だが時計が遅い |
| 20 | 稍重 | やや重い |
| 21 | 速稍重 | 稍重だが時計が速い |
| 22 | 遅稍重 | 稍重だが時計が遅い |
| 30 | 重 | 重い |
| 31 | 速重 | 重だが時計が速い |
| 32 | 遅重 | 重だが時計が遅い |
| 40 | 不良 | 最悪の状態 |
| 41 | 速不良 | 不良だが時計が速い |
| 42 | 遅不良 | 不良だが時計が遅い |

---

### 4.11 種別コード

| コード | 名称 |
|-------|------|
| 11 | 2歳 |
| 12 | 3歳 |
| 13 | 3歳以上 |
| 14 | 4歳以上 |
| 20 | 障害 |
| 99 | その他 |

---

### 4.12 条件コード

| コード | 名称 | 旧表記 |
|-------|------|--------|
| A1 | 新馬 | 新馬 |
| A2 | 未出走 | 未出走 |
| A3 | 未勝利 | 未勝利/0勝 |
| 04 | 1勝クラス | 400万下 |
| 05 | 1勝クラス | 500万下 |
| 10 | 2勝クラス | 1000万下 |
| 16 | 2勝クラス | 1600万下 |
| 15 | 3勝クラス | 1500万下 |
| 16 | 3勝クラス | 1600万下 |
| OP | オープン | オープン |

---

### 4.13 重量種別コード

| コード | 名称 | 説明 |
|-------|------|------|
| 1 | ハンデ | ハンディキャップ競走 |
| 2 | 別定 | 別定重量 |
| 3 | 馬齢 | 馬齢重量 |
| 4 | 定量 | 定量重量 |

---

### 4.14 グレードコード

| コード | 名称 |
|-------|------|
| 1 | G1 |
| 2 | G2 |
| 3 | G3 |
| 4 | 重賞（非G） |
| 5 | 特別 |
| 6 | リステッド |

---

### 4.15 異常区分コード

| コード | 名称 |
|-------|------|
| 0 | 正常 |
| 1 | 取消 |
| 2 | 除外 |
| 3 | 中止 |
| 4 | 失格 |
| 5 | 降着 |
| 6 | 再騎乗 |

---

### 4.16 印コード

| コード | 記号 | 説明 |
|-------|------|------|
| 1 | ◎ | 本命 |
| 2 | ○ | 対抗 |
| 3 | ▲ | 単穴 |
| 4 | 注 | 注目 |
| 5 | △ | 連下 |
| 6 | △ | 連下（別パターン） |
| 9 | ☆ | パドック印 |

---

### 4.17 毛色コード

| コード | 名称 |
|-------|------|
| 01 | 栗毛 |
| 02 | 栃栗毛 |
| 03 | 鹿毛 |
| 04 | 黒鹿毛 |
| 05 | 青鹿毛 |
| 06 | 青毛 |
| 07 | 芦毛 |
| 08 | 栗粕毛 |
| 09 | 鹿粕毛 |
| 10 | 青粕毛 |
| 11 | 白毛 |

---

### 4.18 天候コード

| コード | 名称 |
|-------|------|
| 1 | 晴 |
| 2 | 曇 |
| 3 | 小雨 |
| 4 | 雨 |
| 5 | 小雪 |
| 6 | 雪 |

---

### 4.19 馬具コード（主要なもの）

| コード | 名称 | カテゴリ |
|-------|------|---------|
| 001 | ブリンカー | ハミ |
| 002 | シャドーロール | ハミ |
| 007 | バンテージ | 馬具 |
| 008 | メンコ | 馬具 |
| 045 | ソエ焼く | ソエ状態 |
| 089 | 皮膚病 | 馬状態 |

---

### 4.20 脚元コード（主要なもの）

| コード | 名称 |
|-------|------|
| 000 | バンテージ腕節まで |
| 001 | 蹄汚い |
| 002 | 球節腫れる |
| 010 | バンテージ巻く |
| 047 | 飛節焼き治療 |
| 100 | 歩様悪 |
| 115 | 膝が震える |
| 120 | 肩の出窮屈 |

---

### 4.21 特記コード（主要なもの）

| コード | 名称 | カテゴリ |
|-------|------|---------|
| 033 | 口向き悪い | 行動 |
| 034 | 放馬 | 行動 |
| 040 | 心房細動 | 健康 |
| 041 | 喉鳴り | 健康 |
| 042 | 熱発 | 健康 |
| 043 | 鼻出血 | 健康 |
| 044 | ソエ | 健康 |
| 049 | 気悪 | 性格 |
| 050 | 素直 | 性格 |
| 051 | 根性有り | 性格 |
| 063 | ダ重い○ | 適性 |
| 064 | ダ重い× | 適性 |
| 069 | 芝重い○ | 適性 |
| 070 | 芝重い× | 適性 |
| 087 | 大トビ | レース |
| 410 | 本格化 | レース |
| 449 | ペース速○ | レース |
| 450 | ペース速× | レース |
| 771 | ブリンカー必要 | 馬具 |

---

### 4.22 系統コード（主要な父系統）

**形式**: XXYY（XX=大系統、YY=小系統）

**主要大系統**:
- 11 = ノーザンダンサー系
- 12 = ロイヤルチャージャー系
- 13 = ナスルーラ系
- 14 = ネアルコ系
- 15 = ネイティヴダンサー系
- 16 = フェアウェイ系
- 17 = ダマスカス系
- 18 = ハイペリオン系
- 19 = エクリプス系
- 20 = セントサイモン系

**例**:
- 1101 = ノーザンダンサー
- 1102 = ニジンスキー
- 1109 = サドラーズウェルズ

---

### 4.23 追い状態コード

| コード | 名称 | 説明 |
|-------|------|------|
| 01 | 流す | 軽く流す程度 |
| 02 | 余力あり | まだ余力がある |
| 03 | 終い抑え | 終盤を抑える |
| 04 | 一杯 | 限界まで追う |
| 05 | バテる | 疲れている |
| 06 | 伸びる | 良く伸びる |
| 07 | テンのみ | 前半のみ速い |
| 08 | 鋭く伸び | 鋭い伸び |
| 09 | 強目 | 強めに追う |
| 21 | 引っ張る | 引っ張る動き |
| 22 | 掛かる | 掛かる |
| 24 | テン掛る | 前半掛かる |
| 99 | その他 | その他 |

---

### 4.24 調教コースコード（主要なもの）

**美浦トレーニングセンター（01～10）**:
- 01 = 美浦坂路
- 02 = 南W
- 03 = 南D
- 04 = 南芝
- 05 = 南A
- 10 = ポリトラック

**栗東トレーニングセンター（11～20）**:
- 11 = 栗東坂路
- 12 = CW
- 13 = DW
- 14 = B
- 15 = E
- 16 = 栗芝
- 17 = 栗P
- 18 = 障害
- 19 = プール

**競馬場調教（21～50）**:
- 21～29 = 札幌、函館、福島、新潟など
- 30～49 = 東京、中山、中京、京都、阪神、小倉など
- 50 = 地方競馬

**その他（61～93）**:
- 61 = 障害試験
- 88 = 牧場
- A1 = 連闘
- B1 = その他

---

## 5. データ連携構造

### 5.1 主キー体系

#### レースキー（8桁）
**形式**: 場コード(2) + 年(2) + 回(1) + 日(1) + R(2)

**例**: `05240308`
- 05 = 東京競馬場
- 24 = 2024年
- 03 = 3回開催
- 08 = 8日目
- 08 = 8レース

#### レースキー + 馬番（10桁）
**形式**: レースキー(8) + 馬番(2)

**例**: `0524030808`
- 05240308 = 上記レース
- 08 = 8番馬

#### 血統登録番号（8桁）
**形式**: 英数字8桁

馬の一意識別子。生年と登録順で採番。

#### 成績競走キー（16桁）
**形式**: 血統登録番号(8) + 年月日(8)

**例**: `2020A12320241215`
- 2020A123 = 血統登録番号
- 20241215 = 2024年12月15日

### 5.2 データリンク図

```
┌─────────────────────────────────────────────────────────┐
│                      レースキー                          │
└─────────────────────────────────────────────────────────┘
                            │
        ┌───────────────────┼───────────────────┐
        │                   │                   │
        ↓                   ↓                   ↓
  ┌─────────┐         ┌─────────┐        ┌─────────┐
  │ BA      │         │ KAA     │        │ OZ      │
  │ 番組    │         │ 開催    │        │ オッズ  │
  └─────────┘         └─────────┘        └─────────┘
        │
        └───────────────────┐
                            ↓
              ┌──────────────────────────┐
              │  レースキー + 馬番       │
              └──────────────────────────┘
                            │
        ┌───────────────────┼───────────────────┐
        │                   │                   │
        ↓                   ↓                   ↓
  ┌─────────┐         ┌─────────┐        ┌─────────┐
  │ KY      │         │ JO      │        │ KK      │
  │ 競走馬  │         │ 情報    │        │ 拡張    │
  └─────────┘         └─────────┘        └─────────┘
        │                   │
        │                   │
        ↓                   ↓
  血統登録番号          CHA/CYA
        │              (調教データ)
        │
        ├───────────────────┐
        │                   │
        ↓                   ↓
  ┌─────────┐         ┌─────────┐
  │ UK      │         │ 成績競走キー │
  │ 馬基本  │         └─────────┘
  └─────────┘                │
                            │
        ┌───────────────────┼───────────────────┐
        │                   │                   │
        ↓                   ↓                   ↓
  ┌─────────┐         ┌─────────┐        ┌─────────┐
  │ SE      │         │ SK      │        │ SR      │
  │ 成績    │         │ 成績拡張│        │ レース  │
  └─────────┘         └─────────┘        └─────────┘
        │
        └───────────────────┐
                            ↓
                      ┌─────────┐
                      │ ZE/ZK   │
                      │ 前走    │
                      └─────────┘
```

### 5.3 データ連携の例

#### 例1: 特定のレースの全情報を取得

1. **レースキー**: `05240308`（東京8R）
2. **番組データ（BA）**: レース条件、賞金、距離など
3. **開催データ（KAA）**: 馬場状態、天候など
4. **オッズデータ（OZ）**: 単勝・複勝・馬連オッズ
5. **競走馬データ（KY）**: 各馬の能力指数、印など
6. **情報データ（JO）**: 各馬の情報筋評価
7. **調教データ（CHA/CYA）**: 各馬の調教内容

#### 例2: 特定の馬の過去走を取得

1. **血統登録番号**: `2020A123`
2. **馬基本データ（UK）**: 血統、馬主、生産者情報
3. **競走馬データ（KY）**: 前走1～5の成績競走キーを取得
4. **前走データ（ZE）**: 成績競走キーで過去5走の詳細を取得
5. **成績データ（SE）**: 各走のレース結果、指数など
6. **成績拡張データ（SK）**: 各走の装備、コメントなど

#### 例3: 特定の騎手・調教師の成績を集計

1. **騎手名/調教師名**: 「武豊」「藤沢和雄」など
2. **競走馬データ（KY）**: 騎手名・調教師名で検索
3. **成績データ（SE）**: 該当レースの結果を集計
4. **競走馬拡張データ（KK）**: 騎手・調教師別の成績統計

---

## 6. ファイル形式

### 6.1 基本仕様

| 項目 | 仕様 |
|------|------|
| **形式** | 固定長テキスト |
| **文字コード** | CP932 (Shift-JIS) |
| **改行コード** | CR+LF (Windows形式) |
| **圧縮形式** | LZH |
| **配信方法** | HTTP Basic認証付きダウンロード |

### 6.2 ファイル命名規則

**形式**: `[データタイプ][YYMMDD].lzh`

**例**:
- `KYG241231.lzh` - 2024年12月31日の競走馬データ
- `BAC241231.lzh` - 2024年12月31日の番組データ
- `SEC241231.lzh` - 2024年12月31日週の成績データ

### 6.3 データ処理フロー

1. **ダウンロード**: HTTP Basic認証でLZHファイルを取得
2. **解凍**: LHA形式で圧縮されたファイルを展開
3. **文字コード変換**: CP932 → UTF-8
4. **パース**: 固定長フィールドを分割
5. **CSV変換**: 区切り文字で区切ったCSVに変換
6. **データベース格納**: BigQuery等にロード

### 6.4 データ更新頻度

| データタイプ | 更新曜日 | 更新時刻 | 対象 |
|------------|---------|---------|------|
| KY/UK/ZE/ZK/JO/KK | 金・土 | 19:00/20:00 | 翌日・翌々日のレース |
| BA/KA | 月・木・金・土 | - | 当週・翌週のレース |
| CHA/CYA | 金・土 | 20:00 | 翌日・翌々日のレース |
| OZ/OW/OU/OT/OV | 金・土 | 19:00/20:00 | 翌日・翌々日のレース |
| TY | レース当日 | 各レース発走15分前 | 当日レース |
| HJ | レース当日 | 18:00 | 当日レース |
| SE/SK/SR | 木 | 16:00 | 前週のレース（週次） |

---

## 7. データ活用のベストプラクティス

### 7.1 機械学習での活用

#### 特徴量として重要なフィールド

**KYG（競走馬データ）**:
- IDM、騎手指数、情報指数、総合指数
- 脚質、距離適性、上昇度、調教矢印コード
- 蹄コード、クラスコード

**BAB/BAC（番組データ）**:
- 距離、芝ダ障害コード、条件、グレード
- 重量種別、頭数

**KAA/KAB（開催データ）**:
- 天候コード、馬場状態コード（芝・ダート、内・中・外）
- 馬場差、草丈、転圧、凍結防止剤、中間降水量

**SEC（成績データ）**:
- IDM、素点、馬場差、ペース、出遅、位置取、不利
- テン指数、上がり指数、ペース指数、レースP指数
- コーナー順位、馬体重、馬体重増減

**SKB（成績拡張データ）**:
- 特記コード、馬具コード、脚元コード
- パドックコメント、レースコメント

**CHA/CYA（調教データ）**:
- 追切指数、仕上指数、調教評価
- 調教コースコード、追切種類、追い状態

**KKA（競走馬拡張データ）**:
- 条件別成績（芝/ダート、距離別、馬場別、ペース別）
- 父馬・母父馬の連対率

### 7.2 リーク対策

**絶対に使ってはいけない情報**:
- 確定オッズ（発走後に確定）
- 確定馬体重（発走直前に確定）
- 確定馬場（レース後に確定）
- レース後の指数（SE/SKのIDM、素点など）
- 出走取消・除外の結果反映

**使用可能な情報**:
- 前日オッズ（OZ、金・土19:00/20:00時点）
- 10時オッズ（SECに記録）
- 予想馬場状態（KAA、前日時点）
- 過去走の成績（ZE、SECなど）

### 7.3 時系列分割の重要性

機械学習モデルの学習・検証時には、必ず時系列を考慮した分割を行う。

**NG例**:
- ランダムにtrain/testを分割
- 同一レースのデータがtrainとtestに混在

**OK例**:
- 2019年～2023年6月: 学習データ
- 2023年7月～12月: 検証データ
- 2024年1月～6月: テストデータ

---

## 8. まとめ

### 8.1 データタイプ一覧表

| データタイプ | ファイル | 更新頻度 | レコード長 | 主要内容 |
|------------|---------|---------|-----------|---------|
| KYG/KYH/KYI | 競走馬 | 金・土 | 545 | IDM、指数、印 |
| BAB/BAC | 番組 | 月木金土 | 168-176 | レース条件、賞金 |
| KAA/KAB | 開催 | 月木金土 | 56-72 | 馬場、天候 |
| SEC | 成績 | 木 | 346 | 結果、分析指数 |
| SKB | 成績拡張 | 木 | 304 | 装備、コメント |
| HJA/HJC | 払戻 | レース日 | 240 | 払戻金 |
| UKC | 馬基本 | 金・土 | 292 | 血統、馬主 |
| CHA | 調教本追切 | 金・土 | 64 | 調教タイム |
| CYA/CYB | 調教分析 | 金・土 | 88 | 調教評価 |
| JOA | 情報 | 金・土 | 116 | 情報筋評価 |
| KKA | 競走馬拡張 | 金・土 | 324 | 条件別成績 |
| SRA | 成績レース | 木 | 408 | ハロン、位置取り |
| ZED | 前走 | 金・土 | 346 | 過去5走成績 |
| OZ | オッズ | 金・土 | 957 | 単複馬連オッズ |

### 8.2 推奨活用フロー

1. **データ収集**: `download_all_from_date.sh`で一括ダウンロード
2. **データ変換**: LZH解凍 → CP932→UTF-8 → CSV化
3. **データ格納**: GCS → BigQuery
4. **特徴量生成**: SQL/Pythonでテーブル結合・集計
5. **モデル学習**: LightGBM ランク学習
6. **予測実行**: 前日・当日データで予測
7. **結果検証**: バックテストで回収率評価

---

**End of Document**
